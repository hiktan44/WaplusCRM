<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAIRCHIEFS Toplu Mesaj + BroÅŸÃ¼r Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ’Œ HAIRCHIEFS Toplu Mesaj + BroÅŸÃ¼r</h1>
                    <p class="text-gray-600">Profesyonel ÅŸablonlarla toplu WhatsApp mesajÄ± + HAIRCHIEFS broÅŸÃ¼rÃ¼ gÃ¶nderin</p>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h2 class="text-xl font-semibold mb-4">ğŸ“‹ 1. KiÅŸi Listesi</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">CSV/Excel DosyasÄ± YÃ¼kle</label>
                                <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="text-xs text-gray-500 mt-1">Dosya formatÄ±: name,phone (Ã¶rn: Ahmet YÄ±lmaz,905551234567)</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Manuel GiriÅŸ</label>
                                <textarea id="manualInput" rows="4" 
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                          placeholder="Ahmet YÄ±lmaz,905551234567&#10;Mehmet Demir,905559876543"></textarea>
                            </div>
                            
                            <button onclick="loadContacts()" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200">
                                ğŸ“ KiÅŸileri YÃ¼kle
                            </button>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-xl font-semibold mb-4">ğŸ’¬ 2. Mesaj Åablonu + BroÅŸÃ¼r</h2>
                        <div class="space-y-4">
                            <select id="templateSelect" onchange="selectTemplate()" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Åablon SeÃ§in...</option>
                                <option value="partnership">ğŸ¤ OrtaklÄ±k FÄ±rsatÄ±</option>
                                <option value="promotion">âœ‚ï¸ SaÃ§ Ekimi Promosyonu</option>
                                <option value="consultation">ğŸ‘¨â€âš•ï¸ Ãœcretsiz KonsÃ¼ltasyon</option>
                                <option value="success">â­ BaÅŸarÄ± Hikayesi</option>
                            </select>
                            
                            <textarea id="messageTemplate" rows="8" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="Mesaj ÅŸablonunu seÃ§in veya kendiniz yazÄ±n..."></textarea>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“ Dosya Ekleri (Resim, Video, PDF)</label>
                                
                                <div class="space-y-3">
                                    <!-- File Upload Button -->
                                    <button onclick="document.getElementById('fileUploadInput').click()" 
                                            class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">
                                        ğŸ“¤ Dosya YÃ¼kle (Ã‡oklu - Resim, Video, PDF)
                                    </button>
                                    <input type="file" id="fileUploadInput" multiple class="hidden" 
                                           accept="image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.mp3,.wav,.zip,.rar">
                                    
                                    <!-- Selected Files Display -->
                                    <div id="selectedFilesDisplay" class="hidden">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ”— SeÃ§ili Dosyalar:</label>
                                        <div id="selectedFilesList" class="space-y-2"></div>
                                        <button onclick="clearSelectedFiles()" 
                                                class="mt-2 text-red-600 text-sm hover:text-red-800">
                                            ğŸ—‘ï¸ TÃ¼m DosyalarÄ± Temizle
                                        </button>
                                    </div>
                                    
                                    <!-- Available Files -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Mevcut Dosyalar:</label>
                                        <div id="availableFilesList" class="space-y-2 max-h-40 overflow-y-auto border rounded-md p-2">
                                            <div class="flex items-center space-x-2">
                                                <input type="checkbox" id="file_hairchiefs-brochure.pdf" class="file-checkbox" value="hairchiefs-brochure.pdf">
                                                <label for="file_hairchiefs-brochure.pdf" class="text-sm">ğŸ“„ HAIRCHIEFS BroÅŸÃ¼rÃ¼</label>
                                            </div>
                                        </div>
                                        <button onclick="loadAvailableFiles()" 
                                                class="mt-2 w-full bg-gray-600 text-white py-1 px-3 rounded-md hover:bg-gray-700 transition duration-200 text-sm">
                                            ğŸ”„ Dosya Listesini Yenile
                                        </button>
                                    </div>
                                </div>
                                
                                <p class="text-xs text-green-600 mt-2">âœ¨ Resim, video ve PDF ile daha etkili sonuÃ§lar alÄ±n!</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">GÃ¶nderim AralÄ±ÄŸÄ± (saniye)</label>
                                <input type="number" id="delayInput" value="5" min="1" max="30"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="text-xs text-yellow-600 mt-1">âš ï¸ BroÅŸÃ¼r ile gÃ¶nderim biraz daha uzun sÃ¼rer</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">ğŸ“Š KiÅŸi Listesi ve Durum</h3>
                    
                    <!-- Contact Selection -->
                    <div id="contactSelectionContainer" class="mb-4 hidden">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-medium text-gray-700">ğŸ‘¥ KiÅŸi SeÃ§imi:</h4>
                            <div class="space-x-2">
                                <button onclick="selectAllContacts()" class="text-sm bg-blue-500 text-white px-2 py-1 rounded">âœ… TÃ¼mÃ¼</button>
                                <button onclick="selectNone()" class="text-sm bg-gray-500 text-white px-2 py-1 rounded">âŒ HiÃ§biri</button>
                                <button onclick="selectFirst3()" class="text-sm bg-green-500 text-white px-2 py-1 rounded">ğŸ”¢ Ä°lk 3 (Test)</button>
                            </div>
                        </div>
                        <div id="contactCheckboxList" class="space-y-2 max-h-60 overflow-y-auto border rounded-md p-3 bg-white">
                            <!-- Contact checkboxes will be populated here -->
                        </div>
                        <div id="selectionSummary" class="mt-2 text-sm text-blue-600"></div>
                    </div>
                    
                    <div id="contactList" class="mb-4"></div>
                    <div id="progressContainer" class="hidden">
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                            <div id="progressBar" class="bg-green-600 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                        <p id="progressText" class="text-sm text-gray-600">HazÄ±rlanÄ±yor...</p>
                    </div>
                    <button id="sendButton" onclick="startSending()" disabled 
                            class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition duration-200 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed">
                        ğŸš€ Mesaj + BroÅŸÃ¼r GÃ¶ndermeyi BaÅŸlat
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const templates = {
            partnership: `ğŸ’« Merhaba {name}! âœ¨

ğŸ”¥ HAIRCHIEFS'ten size Ã–ZEL fÄ±rsat! 

ğŸ¯ KUAFÃ–R ORTAKLIK PROGRAMI
âœ… %20'ye varan komisyon oranÄ±
âœ… 50.000â‚º kredi imkanÄ± (6 taksit)
âœ… 8 yÄ±llÄ±k deneyim & 30.000+ baÅŸarÄ±lÄ± iÅŸlem
âœ… 4000 mÂ² alan & modern teknoloji

ğŸ“ DetaylÄ± bilgi iÃ§in ekteki broÅŸÃ¼rÃ¼ inceleyin!

ğŸ“± Hemen iletiÅŸim:
â˜ï¸ 0850 205 02 73

#HAIRCHIEFS #SaÃ§Ekimi #OrtaklÄ±k`,

            promotion: `ğŸŒŸ Merhaba {name}! 

âœ‚ï¸ HAIRCHIEFS Ã–ZEL KAMPANYA! 

ğŸ SADECE BU AY:
âœ… SaÃ§ ekiminde %25 indirim
âœ… Ãœcretsiz saÃ§ analizi
âœ… 12 ay garanti
âœ… VIP transfer hizmeti

ğŸ‘¨â€âš•ï¸ 8 yÄ±llÄ±k tecrÃ¼be ile 30.000+ memnun hasta!

ğŸ“ Kampanya detaylarÄ± ekte!

ğŸ“ Randevu iÃ§in hemen arayÄ±n:
â˜ï¸ 0850 205 02 73

#HAIRCHIEFS #SaÃ§Ekimi #Kampanya`,

            consultation: `ğŸ‘‹ Merhaba {name}!

ğŸ‘¨â€âš•ï¸ ÃœCRETSIZ UZMAN KONSÃœLTASYONU

ğŸ”¬ HAIRCHIEFS'ten size Ã¶zel:
âœ… SaÃ§ dÃ¶kÃ¼lmesi analizi
âœ… KiÅŸisel tedavi planÄ±
âœ… 3D saÃ§ simÃ¼lasyonu
âœ… Fiyat bilgilendirme

ğŸ¥ 30.000+ baÅŸarÄ±lÄ± operasyon tecrÃ¼besi
â­ 4.9 Google puanÄ± ile gÃ¼venilir hizmet

ğŸ“ Hizmetlerimiz hakkÄ±nda detaylar ekte!

ğŸ“± Hemen Ã¼cretsiz analiz iÃ§in:
â˜ï¸ 0850 205 02 73

#HAIRCHIEFS #SaÃ§Analizi #ÃœcretsizKonsÃ¼ltasyon`,

            success: `ğŸ‰ Merhaba {name}!

â­ HAIRCHIEFS BAÅARI HÄ°KAYESÄ°

ğŸ“ˆ 8 yÄ±llÄ±k tecrÃ¼bemizle:
âœ… 30.000+ memnun hasta
âœ… %99 baÅŸarÄ± oranÄ±  
âœ… 4.9 Google yorumu
âœ… DoÄŸal gÃ¶rÃ¼nÃ¼m garantisi

ğŸ’¬ "Hayalindeki saÃ§lara kavuÅŸtum!" 
- Memnun hastalarÄ±mÄ±zdan...

ğŸ“ BaÅŸarÄ± hikayelerimiz ekte!

ğŸ† TÃ¼rkiye'nin en gÃ¼venilir saÃ§ ekimi merkezi

ğŸ“ Siz de aramÄ±za katÄ±lÄ±n:
â˜ï¸ 0850 205 02 73

#HAIRCHIEFS #BaÅŸarÄ±Hikayesi #SaÃ§Ekimi`
        };

        let contacts = [];
        let selectedFiles = [];
        let currentInstance = 'hairchiefs-wa';

        function selectTemplate() {
            const templateKey = document.getElementById('templateSelect').value;
            if (templateKey && templates[templateKey]) {
                document.getElementById('messageTemplate').value = templates[templateKey];
                // Otomatik olarak broÅŸÃ¼rÃ¼ seÃ§ - checkbox ile
                const broÅŸÃ¼rCheckbox = document.getElementById('file_hairchiefs-brochure.pdf');
                if (broÅŸÃ¼rCheckbox) {
                    broÅŸÃ¼rCheckbox.checked = true;
                    updateSelectedFiles();
                }
            }
        }

        function loadContacts() {
            contacts = [];
            
            const fileInput = document.getElementById('fileInput');
            const manualInput = document.getElementById('manualInput').value.trim();
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        if (file.name.endsWith('.csv')) {
                            parseCSV(e.target.result);
                        } else {
                            parseExcel(e.target.result);
                        }
                    } catch (error) {
                        alert('Dosya okuma hatasÄ±: ' + error.message);
                    }
                };
                
                if (file.name.endsWith('.csv')) {
                    reader.readAsText(file);
                } else {
                    reader.readAsBinaryString(file);
                }
            } else if (manualInput) {
                parseCSV(manualInput);
            } else {
                alert('LÃ¼tfen dosya yÃ¼kleyin veya manuel olarak kiÅŸi girin!');
            }
        }

        function parseCSV(csvText) {
            const lines = csvText.trim().split('\\n');
            contacts = [];
            
            lines.forEach(line => {
                const [name, phone] = line.split(',').map(s => s.trim());
                if (name && phone) {
                    contacts.push({name, phone});
                }
            });
            
            updateContactList();
        }

        function parseExcel(binaryStr) {
            const workbook = XLSX.read(binaryStr, {type: 'binary'});
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const data = XLSX.utils.sheet_to_json(worksheet, {header: 1});
            
            contacts = [];
            data.forEach(row => {
                if (row[0] && row[1]) {
                    contacts.push({name: row[0], phone: row[1]});
                }
            });
            
            updateContactList();
        }

        function updateContactList() {
            const listElement = document.getElementById('contactList');
            const selectionContainer = document.getElementById('contactSelectionContainer');
            const checkboxList = document.getElementById('contactCheckboxList');
            
            if (contacts.length > 0) {
                // Show contact selection
                selectionContainer.classList.remove('hidden');
                
                // Create checkboxes for each contact
                checkboxList.innerHTML = contacts.map((contact, index) => `
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="contact_${index}" class="contact-checkbox" value="${index}" onchange="updateContactSelection()" checked>
                        <label for="contact_${index}" class="text-sm cursor-pointer">ğŸ“ ${contact.name} (${contact.phone})</label>
                    </div>
                `).join('');
                
                // Show summary
                listElement.innerHTML = `
                    <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                        <p class="text-green-800 font-medium">ğŸ“ ${contacts.length} kiÅŸi yÃ¼klendi!</p>
                        <div class="mt-2 text-sm text-green-600">
                            ${contacts.slice(0, 3).map(c => `â€¢ ${c.name} (${c.phone})`).join('<br>')}
                            ${contacts.length > 3 ? `<br><em>... ve ${contacts.length - 3} kiÅŸi daha</em>` : ''}
                        </div>
                    </div>
                `;
                
                updateContactSelection();
            } else {
                selectionContainer.classList.add('hidden');
                listElement.innerHTML = `
                    <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                        <p class="text-red-800">âŒ KiÅŸi listesi boÅŸ!</p>
                    </div>
                `;
                document.getElementById('sendButton').disabled = true;
            }
        }

        // Update contact selection
        function updateContactSelection() {
            const checkboxes = document.querySelectorAll('.contact-checkbox');
            const selectedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            const summary = document.getElementById('selectionSummary');
            
            summary.textContent = `ğŸ¯ ${selectedCount} kiÅŸi seÃ§ildi (${contacts.length} kiÅŸiden)`;
            
            const sendButton = document.getElementById('sendButton');
            sendButton.disabled = selectedCount === 0;
            sendButton.textContent = selectedCount > 0 
                ? `ğŸš€ ${selectedCount} KiÅŸiye Mesaj + Ek GÃ¶nder`
                : 'ğŸš€ Mesaj + BroÅŸÃ¼r GÃ¶ndermeyi BaÅŸlat';
        }

        // Contact selection functions
        function selectAllContacts() {
            const checkboxes = document.querySelectorAll('.contact-checkbox');
            checkboxes.forEach(cb => cb.checked = true);
            updateContactSelection();
        }

        function selectNone() {
            const checkboxes = document.querySelectorAll('.contact-checkbox');
            checkboxes.forEach(cb => cb.checked = false);
            updateContactSelection();
        }

        function selectFirst3() {
            const checkboxes = document.querySelectorAll('.contact-checkbox');
            checkboxes.forEach((cb, index) => cb.checked = index < 3);
            updateContactSelection();
        }

        async function startSending() {
            const template = document.getElementById('messageTemplate').value;
            const delay = parseInt(document.getElementById('delayInput').value);
            
            // Get selected contacts
            const selectedContacts = [];
            const checkboxes = document.querySelectorAll('.contact-checkbox');
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    const index = parseInt(cb.value);
                    selectedContacts.push(contacts[index]);
                }
            });
            
            if (!template) {
                alert('LÃ¼tfen mesaj ÅŸablonu seÃ§in!');
                return;
            }
            
            if (selectedContacts.length === 0) {
                alert('LÃ¼tfen en az bir kiÅŸi seÃ§in!');
                return;
            }

            document.getElementById('progressContainer').classList.remove('hidden');
            document.getElementById('sendButton').disabled = true;
            
            let sent = 0;
            let failed = 0;

            for (let i = 0; i < selectedContacts.length; i++) {
                const contact = selectedContacts[i];
                const personalizedMessage = template.replace('{name}', contact.name);
                
                try {
                    const response = await fetch(`/message/sendText/${currentInstance}`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            number: contact.phone,
                            text: personalizedMessage,
                            delay: delay,
                            attachments: selectedFiles // Ã‡oklu dosya desteÄŸi
                        })
                    });

                    if (response.ok) {
                        sent++;
                        const data = await response.json();
                        console.log('Message sent:', data);
                    } else {
                        failed++;
                        const errorData = await response.json();
                        console.error('Send failed:', errorData);
                    }
                } catch (error) {
                    failed++;
                    console.error('Request error:', error);
                }

                const progress = ((i + 1) / selectedContacts.length) * 100;
                document.getElementById('progressBar').style.width = progress + '%';
                
                const attachmentStatus = selectedFiles.length > 0 ? ` (ğŸ“ ${selectedFiles.length} ek ile)` : '';
                document.getElementById('progressText').textContent = 
                    `Ä°lerleme: ${i + 1}/${selectedContacts.length}${attachmentStatus} - BaÅŸarÄ±lÄ±: ${sent}, BaÅŸarÄ±sÄ±z: ${failed}`;
                
                if (i < selectedContacts.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, delay * 1000));
                }
            }

            const attachmentSummary = selectedFiles.length > 0 ? ` + ${selectedFiles.length} ek` : '';
            document.getElementById('progressText').textContent = 
                `âœ… GÃ¶nderim tamamlandÄ±! BaÅŸarÄ±lÄ±: ${sent}, BaÅŸarÄ±sÄ±z: ${failed}${attachmentSummary}`;
            document.getElementById('sendButton').disabled = false;
        }

        // File Upload Functions
        document.getElementById('fileUploadInput').addEventListener('change', async function(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            const formData = new FormData();
            files.forEach(file => {
                formData.append('files', file);
            });

            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert(`âœ… ${result.count} dosya baÅŸarÄ±yla yÃ¼klendi!`);
                    loadAvailableFiles();
                } else {
                    alert('âŒ Upload hatasÄ±: ' + result.error);
                }
            } catch (error) {
                alert('âŒ Upload hatasÄ±: ' + error.message);
            }
        });

        // Load available files as checkboxes
        async function loadAvailableFiles() {
            try {
                const response = await fetch('/api/files');
                const result = await response.json();
                
                const container = document.getElementById('availableFilesList');
                if (!container) {
                    console.warn('availableFilesList element not found');
                    return;
                }
                
                container.innerHTML = '';
                
                result.files.forEach(file => {
                    const icon = getFileIcon(file.originalname);
                    const div = document.createElement('div');
                    div.className = 'flex items-center space-x-2';
                    div.innerHTML = `
                        <input type="checkbox" id="file_${file.filename}" class="file-checkbox" value="${file.filename}" onchange="updateSelectedFiles()">
                        <label for="file_${file.filename}" class="text-sm cursor-pointer">${icon} ${file.originalname} (${formatFileSize(file.size)})</label>
                    `;
                    container.appendChild(div);
                });
                
                updateSelectedFiles();
            } catch (error) {
                console.error('Files loading error:', error);
            }
        }

        // Get file icon
        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return 'ğŸ–¼ï¸';
            if (['mp4', 'mov', 'avi', 'mkv'].includes(ext)) return 'ğŸ¥';
            if (ext === 'pdf') return 'ğŸ“„';
            if (['doc', 'docx'].includes(ext)) return 'ğŸ“';
            if (['mp3', 'wav'].includes(ext)) return 'ğŸµ';
            return 'ğŸ“';
        }

        // Update selected files
        function updateSelectedFiles() {
            const checkboxes = document.querySelectorAll('.file-checkbox');
            selectedFiles = [];
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    selectedFiles.push(cb.value);
                }
            });
            
            const display = document.getElementById('selectedFilesDisplay');
            const list = document.getElementById('selectedFilesList');
            
            if (display && list) {
                if (selectedFiles.length > 0) {
                    display.classList.remove('hidden');
                    list.innerHTML = selectedFiles.map(filename => {
                        const icon = getFileIcon(filename);
                        return `<div class="flex items-center justify-between bg-blue-50 p-2 rounded">
                            <span class="text-sm">${icon} ${filename}</span>
                            <button onclick="removeSelectedFile('${filename}')" class="text-red-500 hover:text-red-700 text-xs">âŒ</button>
                        </div>`;
                    }).join('');
                } else {
                    display.classList.add('hidden');
                }
            }
        }

        // Remove selected file
        function removeSelectedFile(filename) {
            const checkbox = document.getElementById(`file_${filename}`);
            if (checkbox) {
                checkbox.checked = false;
                updateSelectedFiles();
            }
        }

        // Clear all selected files
        function clearSelectedFiles() {
            const checkboxes = document.querySelectorAll('.file-checkbox');
            checkboxes.forEach(cb => cb.checked = false);
            updateSelectedFiles();
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Load files on page load
        window.addEventListener('load', loadAvailableFiles);
    </script>
</body>
</html>