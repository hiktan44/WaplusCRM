<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAIRCHIEFS Toplu Mesaj + BroÅŸÃ¼r Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ’Œ HAIRCHIEFS Toplu Mesaj + BroÅŸÃ¼r</h1>
                    <p class="text-gray-600">Profesyonel ÅŸablonlarla toplu WhatsApp mesajÄ± + HAIRCHIEFS broÅŸÃ¼rÃ¼ gÃ¶nderin</p>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h2 class="text-xl font-semibold mb-4">ğŸ“‹ 1. KiÅŸi Listesi</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">CSV/Excel DosyasÄ± YÃ¼kle</label>
                                <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="text-xs text-gray-500 mt-1">Dosya formatÄ±: name,phone (Ã¶rn: Ahmet YÄ±lmaz,905551234567)</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Manuel GiriÅŸ</label>
                                <textarea id="manualInput" rows="4" 
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                          placeholder="Ahmet YÄ±lmaz,905551234567&#10;Mehmet Demir,905559876543"></textarea>
                            </div>
                            
                            <button onclick="loadContacts()" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200">
                                ğŸ“ KiÅŸileri YÃ¼kle
                            </button>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-xl font-semibold mb-4">ğŸ’¬ 2. Mesaj Åablonu + BroÅŸÃ¼r</h2>
                        <div class="space-y-4">
                            <select id="templateSelect" onchange="selectTemplate()" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Åablon SeÃ§in...</option>
                                <option value="partnership">ğŸ¤ OrtaklÄ±k FÄ±rsatÄ±</option>
                                <option value="promotion">âœ‚ï¸ SaÃ§ Ekimi Promosyonu</option>
                                <option value="consultation">ğŸ‘¨â€âš•ï¸ Ãœcretsiz KonsÃ¼ltasyon</option>
                                <option value="success">â­ BaÅŸarÄ± Hikayesi</option>
                            </select>
                            
                            <textarea id="messageTemplate" rows="8" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="Mesaj ÅŸablonunu seÃ§in veya kendiniz yazÄ±n..."></textarea>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“ HAIRCHIEFS BroÅŸÃ¼rÃ¼</label>
                                <select id="attachmentSelect" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="none">âŒ BroÅŸÃ¼r Ekleme</option>
                                    <option value="hairchiefs-brochure.pdf">ğŸ“„ HAIRCHIEFS BroÅŸÃ¼rÃ¼ Ekle</option>
                                </select>
                                <p class="text-xs text-green-600 mt-1">âœ¨ BroÅŸÃ¼r ile daha etkili sonuÃ§lar alÄ±n!</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">GÃ¶nderim AralÄ±ÄŸÄ± (saniye)</label>
                                <input type="number" id="delayInput" value="5" min="1" max="30"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="text-xs text-yellow-600 mt-1">âš ï¸ BroÅŸÃ¼r ile gÃ¶nderim biraz daha uzun sÃ¼rer</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">ğŸ“Š Durum</h3>
                    <div id="contactList" class="mb-4"></div>
                    <div id="progressContainer" class="hidden">
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                            <div id="progressBar" class="bg-green-600 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                        <p id="progressText" class="text-sm text-gray-600">HazÄ±rlanÄ±yor...</p>
                    </div>
                    <button id="sendButton" onclick="startSending()" disabled 
                            class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition duration-200 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed">
                        ğŸš€ Mesaj + BroÅŸÃ¼r GÃ¶ndermeyi BaÅŸlat
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const templates = {
            partnership: `ğŸ’« Merhaba {name}! âœ¨

ğŸ”¥ HAIRCHIEFS'ten size Ã–ZEL fÄ±rsat! 

ğŸ¯ KUAFÃ–R ORTAKLIK PROGRAMI
âœ… %20'ye varan komisyon oranÄ±
âœ… 50.000â‚º kredi imkanÄ± (6 taksit)
âœ… 8 yÄ±llÄ±k deneyim & 30.000+ baÅŸarÄ±lÄ± iÅŸlem
âœ… 4000 mÂ² alan & modern teknoloji

ğŸ“ DetaylÄ± bilgi iÃ§in ekteki broÅŸÃ¼rÃ¼ inceleyin!

ğŸ“± Hemen iletiÅŸim:
â˜ï¸ 0850 205 02 73

#HAIRCHIEFS #SaÃ§Ekimi #OrtaklÄ±k`,

            promotion: `ğŸŒŸ Merhaba {name}! 

âœ‚ï¸ HAIRCHIEFS Ã–ZEL KAMPANYA! 

ğŸ SADECE BU AY:
âœ… SaÃ§ ekiminde %25 indirim
âœ… Ãœcretsiz saÃ§ analizi
âœ… 12 ay garanti
âœ… VIP transfer hizmeti

ğŸ‘¨â€âš•ï¸ 8 yÄ±llÄ±k tecrÃ¼be ile 30.000+ memnun hasta!

ğŸ“ Kampanya detaylarÄ± ekte!

ğŸ“ Randevu iÃ§in hemen arayÄ±n:
â˜ï¸ 0850 205 02 73

#HAIRCHIEFS #SaÃ§Ekimi #Kampanya`,

            consultation: `ğŸ‘‹ Merhaba {name}!

ğŸ‘¨â€âš•ï¸ ÃœCRETSIZ UZMAN KONSÃœLTASYONU

ğŸ”¬ HAIRCHIEFS'ten size Ã¶zel:
âœ… SaÃ§ dÃ¶kÃ¼lmesi analizi
âœ… KiÅŸisel tedavi planÄ±
âœ… 3D saÃ§ simÃ¼lasyonu
âœ… Fiyat bilgilendirme

ğŸ¥ 30.000+ baÅŸarÄ±lÄ± operasyon tecrÃ¼besi
â­ 4.9 Google puanÄ± ile gÃ¼venilir hizmet

ğŸ“ Hizmetlerimiz hakkÄ±nda detaylar ekte!

ğŸ“± Hemen Ã¼cretsiz analiz iÃ§in:
â˜ï¸ 0850 205 02 73

#HAIRCHIEFS #SaÃ§Analizi #ÃœcretsizKonsÃ¼ltasyon`,

            success: `ğŸ‰ Merhaba {name}!

â­ HAIRCHIEFS BAÅARI HÄ°KAYESÄ°

ğŸ“ˆ 8 yÄ±llÄ±k tecrÃ¼bemizle:
âœ… 30.000+ memnun hasta
âœ… %99 baÅŸarÄ± oranÄ±  
âœ… 4.9 Google yorumu
âœ… DoÄŸal gÃ¶rÃ¼nÃ¼m garantisi

ğŸ’¬ "Hayalindeki saÃ§lara kavuÅŸtum!" 
- Memnun hastalarÄ±mÄ±zdan...

ğŸ“ BaÅŸarÄ± hikayelerimiz ekte!

ğŸ† TÃ¼rkiye'nin en gÃ¼venilir saÃ§ ekimi merkezi

ğŸ“ Siz de aramÄ±za katÄ±lÄ±n:
â˜ï¸ 0850 205 02 73

#HAIRCHIEFS #BaÅŸarÄ±Hikayesi #SaÃ§Ekimi`
        };

        let contacts = [];
        let currentInstance = 'hairchiefs-wa';

        function selectTemplate() {
            const templateKey = document.getElementById('templateSelect').value;
            if (templateKey && templates[templateKey]) {
                document.getElementById('messageTemplate').value = templates[templateKey];
                // Otomatik olarak broÅŸÃ¼rÃ¼ seÃ§
                document.getElementById('attachmentSelect').value = 'hairchiefs-brochure.pdf';
            }
        }

        function loadContacts() {
            contacts = [];
            
            const fileInput = document.getElementById('fileInput');
            const manualInput = document.getElementById('manualInput').value.trim();
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        if (file.name.endsWith('.csv')) {
                            parseCSV(e.target.result);
                        } else {
                            parseExcel(e.target.result);
                        }
                    } catch (error) {
                        alert('Dosya okuma hatasÄ±: ' + error.message);
                    }
                };
                
                if (file.name.endsWith('.csv')) {
                    reader.readAsText(file);
                } else {
                    reader.readAsBinaryString(file);
                }
            } else if (manualInput) {
                parseCSV(manualInput);
            } else {
                alert('LÃ¼tfen dosya yÃ¼kleyin veya manuel olarak kiÅŸi girin!');
            }
        }

        function parseCSV(csvText) {
            const lines = csvText.trim().split('\\n');
            contacts = [];
            
            lines.forEach(line => {
                const [name, phone] = line.split(',').map(s => s.trim());
                if (name && phone) {
                    contacts.push({name, phone});
                }
            });
            
            updateContactList();
        }

        function parseExcel(binaryStr) {
            const workbook = XLSX.read(binaryStr, {type: 'binary'});
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const data = XLSX.utils.sheet_to_json(worksheet, {header: 1});
            
            contacts = [];
            data.forEach(row => {
                if (row[0] && row[1]) {
                    contacts.push({name: row[0], phone: row[1]});
                }
            });
            
            updateContactList();
        }

        function updateContactList() {
            const listElement = document.getElementById('contactList');
            const attachment = document.getElementById('attachmentSelect').value;
            
            if (contacts.length > 0) {
                const attachmentText = attachment !== 'none' ? ' + ğŸ“ BroÅŸÃ¼r' : '';
                listElement.innerHTML = `<p class="text-green-600 font-medium">âœ… ${contacts.length} kiÅŸi yÃ¼klendi${attachmentText}</p>`;
                document.getElementById('sendButton').disabled = false;
            } else {
                listElement.innerHTML = '<p class="text-red-600">âŒ HiÃ§ kiÅŸi yÃ¼klenmedi</p>';
                document.getElementById('sendButton').disabled = true;
            }
        }

        async function startSending() {
            const template = document.getElementById('messageTemplate').value;
            const delay = parseInt(document.getElementById('delayInput').value);
            const attachment = document.getElementById('attachmentSelect').value;
            
            if (!template) {
                alert('LÃ¼tfen mesaj ÅŸablonu seÃ§in!');
                return;
            }

            document.getElementById('progressContainer').classList.remove('hidden');
            document.getElementById('sendButton').disabled = true;
            
            let sent = 0;
            let failed = 0;

            for (let i = 0; i < contacts.length; i++) {
                const contact = contacts[i];
                const personalizedMessage = template.replace('{name}', contact.name);
                
                try {
                    const response = await fetch(`/message/sendText/${currentInstance}`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            number: contact.phone,
                            text: personalizedMessage,
                            delay: delay,
                            attachment: attachment
                        })
                    });

                    if (response.ok) {
                        sent++;
                        const data = await response.json();
                        console.log('Message sent:', data);
                    } else {
                        failed++;
                        const errorData = await response.json();
                        console.error('Send failed:', errorData);
                    }
                } catch (error) {
                    failed++;
                    console.error('Request error:', error);
                }

                const progress = ((i + 1) / contacts.length) * 100;
                document.getElementById('progressBar').style.width = progress + '%';
                
                const attachmentStatus = attachment !== 'none' ? ' (ğŸ“ BroÅŸÃ¼r ile)' : '';
                document.getElementById('progressText').textContent = 
                    `Ä°lerleme: ${i + 1}/${contacts.length}${attachmentStatus} - BaÅŸarÄ±lÄ±: ${sent}, BaÅŸarÄ±sÄ±z: ${failed}`;
                
                if (i < contacts.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, delay * 1000));
                }
            }

            const attachmentSummary = attachment !== 'none' ? ' + BroÅŸÃ¼r' : '';
            document.getElementById('progressText').textContent = 
                `âœ… GÃ¶nderim tamamlandÄ±! BaÅŸarÄ±lÄ±: ${sent}, BaÅŸarÄ±sÄ±z: ${failed}${attachmentSummary}`;
            document.getElementById('sendButton').disabled = false;
        }

        // Attachment seÃ§imi deÄŸiÅŸtiÄŸinde contact listesini gÃ¼ncelle
        document.getElementById('attachmentSelect').addEventListener('change', updateContactList);
    </script>
</body>
</html>